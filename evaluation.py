# Script used to compare the similarity between the ground truth, and LLM output
# Both outputs will be in markdown format

import jiwer
import argparse
import json
import difflib

# https://github.com/rtfpessoa/diff2html?tab=readme-ov-file
# Add an argument that defines diff file output
parser = argparse.ArgumentParser()
parser.add_argument("--ground_truth", help="Markdown file containing the ground truth", type=str, required=True)
parser.add_argument("ocr_output", help="Markdown file containing the OCR output generated by the LLM")
args = parser.parse_args()

def calculate_cer_and_wer(ground_truth, ocr_output):
    cer = jiwer.cer(ground_truth, ocr_output)
    wer = jiwer.wer(ground_truth, ocr_output)
    return (cer, wer)

def generate_unified_diff(ground_truth, ocr_output):
    unified_diff = difflib.unified_diff(ground_truth.splitlines(), ocr_output.splitlines(), lineterm='')
    with open("unified_diff", "w", encoding="utf-8") as f:
        f.write('\n'.join(list(unified_diff)))

def read_markdown_file(file_path):
    # Read markdown file, and return it as a str variable
    with open(file_path, 'r', encoding='utf-8') as file:
        data = file.read()
        return data

def main():
    ground_truth = read_markdown_file(args.ground_truth)
    ocr_output = read_markdown_file(args.ocr_output)
    score = calculate_cer_and_wer(ground_truth, ocr_output)
    print(f"CER: {score[0]}\nWER: {score[1]}")
    generate_unified_diff(ground_truth, ocr_output)
    

if __name__ == "__main__":
    main() 